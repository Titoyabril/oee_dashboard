{% load plotly_dash %}

<h1>OEE Dashboard</h1>

<!-- Live WebSocket banner (real-time) -->
<div id="ws-status" style="font:14px/1.4 system-ui; margin:8px 0;">
  <strong>Live events:</strong>
  <span id="last-event" style="padding:2px 6px;border-radius:6px;background:#eee;">(waiting...)</span>
</div>

<script>
  (function () {
    const loc = window.location;
    const proto = loc.protocol === "https:" ? "wss://" : "ws://";
    const ws = new WebSocket(proto + loc.host + "/ws/events/");

    ws.onmessage = (ev) => {
      try {
        const e = JSON.parse(ev.data);
        const text = `${e.ts} — ${e.line_id}/${e.station_id} — ${e.reason} (${e.duration_s}s)`;
        document.getElementById("last-event").textContent = text;
      } catch {}
    };
  })();
</script>

<!-- Your existing Plotly Dash timeline -->
{% include "oee_analytics/dashboard_timeline.html" %}
