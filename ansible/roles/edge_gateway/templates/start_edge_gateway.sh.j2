#!/bin/bash
# OEE Edge Gateway Startup Script
# Generated by Ansible

set -e

# Activate virtual environment
source {{ edge_install_dir }}/venv/bin/activate

# Set Python path
export PYTHONPATH={{ edge_install_dir }}:$PYTHONPATH

# Load configuration
export OEE_CONFIG={{ edge_config_dir }}/edge_gateway.yml
export OEE_ENVIRONMENT={{ oee_environment }}

# Log startup
echo "[$(date)] Starting OEE Edge Gateway {{ edge_node_id }}" >> {{ edge_logs_dir }}/startup.log

# Run edge gateway
exec python3 -m oee_analytics.sparkplug.edge_gateway \
    --config "$OEE_CONFIG" \
    --node-id "{{ edge_node_id }}" \
    2>&1 | tee -a {{ edge_logs_dir }}/edge_gateway.log
